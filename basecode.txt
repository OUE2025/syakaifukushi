import React, { useState, useEffect, useMemo } from 'react';
import {
  BookOpen,
  CheckCircle2,
  XCircle,
  Trophy,
  RefreshCcw,
  ChevronRight,
  ChevronLeft,
  GraduationCap,
  Heart,
  Smile,
  Frown,
  Star
} from 'lucide-react';

// --- ã‚¯ã‚¤ã‚ºãƒ‡ãƒ¼ã‚¿ ---
// æä¾›ã•ã‚ŒãŸ129å•ã®ãƒ‡ãƒ¼ã‚¿ã‚’å…ƒã«ã€ä¸»è¦ãªå•é¡Œã¨æ­£è§£ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦æ§‹é€ åŒ–
const rawQuestions = [
  { id: 1, category: "åŒ»å­¦æ¦‚è«–", question: "æ€æ˜¥æœŸãƒ»é’å¹´æœŸã«ãŠã‘ã‚‹å¿ƒèº«ã®ç‰¹å¾´ã«é–¢ã™ã‚‹æ¬¡ã®è¨˜è¿°ã®ã†ã¡ï¼Œæ­£ã—ã„ã‚‚ã®ã‚’ 1 ã¤é¸ã³ãªã•ã„ã€‚", options: ["æ€æ˜¥æœŸã«ã¯ï¼Œç”·å¥³ã¨ã‚‚ã«ç·©ã‚„ã‹ãªèº«ä½“ã®å¤‰åŒ–ãŒã¿ã‚‰ã‚Œã‚‹ã€‚", "æ€æ˜¥æœŸã«ãŠã‘ã‚‹å¿ƒç†çš„ç‰¹å¾´ã¨ã—ã¦ã¯ï¼Œè‡ªæ„è­˜éå‰°ãŒã‚ã‚‹ã€‚", "æ€æ˜¥æœŸã«ã¯ï¼Œã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¯å½¢æˆã•ã‚Œã¦ã„ã‚‹ã€‚", "ç¬¬äºŒæ¬¡æ€§å¾´ã«æ€§å·®ã¯ã¿ã‚‰ã‚Œãªã„ã€‚", "é’å¹´æœŸã®æ­»äº¡åŸå› ã¨ã—ã¦ã¯å¿ƒç–¾æ‚£ãŒæœ€ã‚‚å¤šã„ã€‚"], correct: [1] }, // 0-indexed
  { id: 2, category: "åŒ»å­¦æ¦‚è«–", question: "é«˜é½¢è€…ã«ãŠã‘ã‚‹è–¬å®³æœ‰å®³äº‹è±¡ã®ç™ºç”Ÿäºˆé˜²ã‚„ç™ºç”Ÿæ™‚ã®å¯¾å‡¦æ–¹æ³•ã«é–¢ã™ã‚‹æ¬¡ã®è¨˜è¿°ã®ã†ã¡ï¼Œæœ€ã‚‚é©åˆ‡ãªã‚‚ã®ã‚’ 1 ã¤é¸ã³ãªã•ã„ã€‚", options: ["æœç”¨æ³•ã‚’è¤‡é›‘ã«ã™ã‚‹ã€‚", "å®šæœŸçš„ã«å‡¦æ–¹å†…å®¹ã‚’è¦‹ç›´ã™ã€‚", "è‹¥å¹´è€…ã¨åŒã˜æŠ•ä¸é‡ã«ã™ã‚‹ã€‚", "æŠ•ä¸è–¬å‰¤ã®æ•°ã¯ãªã‚‹ã¹ã 8å‰¤ä»¥ä¸‹ã«ã™ã‚‹ã€‚", "æ–°è¦ç—‡çŠ¶ãŒå‡ºç¾ã—ãŸå ´åˆã«è–¬å‰¤ã‚’è¿½åŠ ã™ã‚‹ã€‚"], correct: [1] },
  { id: 3, category: "åŒ»å­¦æ¦‚è«–", question: "ç­‹éª¨æ ¼ç³»ã«é–¢ã™ã‚‹æ¬¡ã®è¨˜è¿°ã®ã†ã¡ï¼Œæ­£ã—ã„ã‚‚ã®ã‚’ 1 ã¤é¸ã³ãªã•ã„ã€‚", options: ["ç­‹è‚‰ã¯éª¨æ ¼ç­‹ã¨å¿ƒç­‹ã® 2ç¨®é¡ã‹ã‚‰ãªã‚‹ã€‚", "ç­‹çµ„ç¹”ã«ã¯ã‚«ãƒ«ã‚·ã‚¦ãƒ ã‚’è²¯è”µã™ã‚‹åƒããŒã‚ã‚‹ã€‚", "äººä½“ã¯ç´„ 400 å€‹ã®éª¨ã‹ã‚‰ãªã‚‹ã€‚", "éª¨é‡ã¯å°å…æœŸã«æœ€å¤§ã¨ãªã‚Šï¼Œé’å¹´æœŸä»¥é™ã¯æ¸›å°‘ã™ã‚‹ã€‚", "éª¨ã«ã¯è¡€çƒã‚’ã¤ãã‚‹åƒããŒã‚ã‚‹ã€‚"], correct: [4] },
  { id: 4, category: "åŒ»å­¦æ¦‚è«–", question: "é›£ç—…ã«é–¢ã™ã‚‹æ¬¡ã®è¨˜è¿°ã®ã†ã¡ï¼Œæ­£ã—ã„ã‚‚ã®ã‚’ 2 ã¤é¸ã³ãªã•ã„ã€‚", options: ["ç™ºç—…ã®æ©Ÿæ§‹ãŒæ˜ã‚‰ã‹ã§ãªã„ç–¾æ‚£ã§ã‚ã‚‹ã“ã¨ã¯ï¼Œã€ŒæŒ‡å®šé›£ç—…ã€ã®è¦ä»¶ã®ä¸€ã¤ã§ã‚ã‚‹ã€‚", "ã€ŒæŒ‡å®šé›£ç—…ã€ã§ã¯ï¼Œå®¢è¦³çš„ãªè¨ºæ–­åŸºæº–ãŒå®šã¾ã£ã¦ã„ã‚‹ã€‚", "ã€ŒæŒ‡å®šé›£ç—…ã€ã®æ‚£è€…æ•°ã¯æˆ‘ãŒå›½ã«ãŠã„ã¦äººå£ã® 1ï¼…ç¨‹åº¦ã«é”ã™ã‚‹ã€‚", "ã€Œéšœå®³è€…ç·åˆæ”¯æ´æ³•ã€ã®å¯¾è±¡ç–¾æ‚£ã¯ï¼Œã€ŒæŒ‡å®šé›£ç—…ã€ã‚ˆã‚Šå¯¾è±¡ç¯„å›²ãŒç‹­ã„ã€‚", "å°å…ã®é›£ç—…ã«ã¤ã„ã¦ã¯ï¼Œæ³•å¾‹ã«åŸºã¥ãé›£ç—…å¯¾ç­–ã¯ãªã„ã€‚"], correct: [0, 1] },
  { id: 5, category: "åŒ»å­¦æ¦‚è«–", question: "è‚ºç‚ã«é–¢ã™ã‚‹æ¬¡ã®è¨˜è¿°ã®ã†ã¡ï¼Œæœ€ã‚‚é©åˆ‡ãªã‚‚ã®ã‚’ 1 ã¤é¸ã³ãªã•ã„ã€‚", options: ["å¸‚ä¸­è‚ºç‚ã®èµ·å› èŒã¯è‚ºç‚çƒèŒãŒæœ€ã‚‚å¤šã„ã€‚", "èª¤åš¥æ€§è‚ºç‚ã¯è‹¥å¹´è€…ã«å¤šã„ã€‚", "å£è…”ã‚±ã‚¢ã«ã‚ˆã£ã¦å¢—æ‚ªã™ã‚‹ã€‚", "çµŒçš®çš„é…¸ç´ é£½å’Œåº¦ï¼ˆSpO2ï¼‰ãŒä¸Šæ˜‡ã™ã‚‹ã€‚", "è‚ºç‚ã®è¨ºæ–­ã«ã¯ç™ºç†±ãŒå¿…é ˆã§ã‚ã‚‹ã€‚"], correct: [0] },
  { id: 6, category: "åŒ»å­¦æ¦‚è«–", question: "äº‹ä¾‹ã‚’èª­ã‚“ã§ï¼Œï¼¡ã•ã‚“ã«æœ€ã‚‚é©åˆ‡ãªå…¥é™¢å½¢æ…‹ã‚’ 1 ã¤é¸ã³ãªã•ã„ã€‚ã€”äº‹ã€€ä¾‹ã€•å¤§å­¦4å¹´ç”Ÿã§æŠ‘ã†ã¤æ°—åˆ†ç­‰ã‚’å‘ˆã—ã€ä¸»æ²»åŒ»ã¨ä¸¡è¦ªã®èª¬æ˜ã‚’å—ã‘æœ¬äººãŒå…¥é™¢ã‚’å¸Œæœ›ã—ãŸã€‚", options: ["åŒ»ç™‚ä¿è­·å…¥é™¢", "æªç½®å…¥é™¢", "ç·Šæ€¥æªç½®å…¥é™¢", "ä»»æ„å…¥é™¢", "å¿œæ€¥å…¥é™¢"], correct: [3] },
  { id: 7, category: "å¿ƒç†å­¦", question: "æ¬¡ã®è¨˜è¿°ã®ã†ã¡ï¼Œã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰è¨˜æ†¶ã®äº‹ä¾‹ã¨ã—ã¦ï¼Œæœ€ã‚‚é©åˆ‡ãªã‚‚ã®ã‚’ 1 ã¤é¸ã³ãªã•ã„ã€‚", options: ["æš—ç®—ã‚’ã™ã‚‹éš›ã«ï¼Œé€”ä¸­ã®è¨ˆç®—çµæœã‚’è¦šãˆã¦ãŠããªãŒã‚‰è¨ˆç®—ã‚’é€²ã‚ãŸã€‚", "ç›¸æ‰‹ã®é›»è©±ç•ªå·ã‚’èã„ã¦ï¼Œæºå¸¯é›»è©±ã«ç™»éŒ²ã™ã‚‹ã¾ã§è¦šãˆã¦ã„ãŸã€‚", "ã‚«ãƒŠãƒ€ã¯åŒ—ã‚¢ãƒ¡ãƒªã‚«å¤§é™¸ã«ã‚ã‚‹å›½ã ã¨è¦šãˆã¦ã„ãŸã€‚", "æ˜”ï¼Œç·´ç¿’ã—ã¦ä¹—ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸè‡ªè»¢è»Šã«ï¼Œä»Šã§ã‚‚ã†ã¾ãä¹—ã‚‹ã“ã¨ãŒã§ããŸã€‚", "æ˜¨æ—¥ã®æ™©å¾¡é£¯ã«ã¨ã‚“ã‹ã¤ã‚’é£Ÿã¹ãŸã“ã¨ã‚’æ€ã„å‡ºã—ãŸã€‚"], correct: [4] },
  { id: 8, category: "å¿ƒç†å­¦", question: "ç¤¾ä¼šçš„æŠ‘åˆ¶ã«ã‚ˆã‚‹äº‹ä¾‹ã¨ã—ã¦ï¼Œæœ€ã‚‚é©åˆ‡ãªã‚‚ã®ã‚’ 1 ã¤é¸ã³ãªã•ã„ã€‚", options: ["ä»–äººãŒã„ã‚‹ã“ã¨ã§ã‚„ã‚‹æ°—ãŒå‡ºãŸäº‹ä¾‹", "å‘¨å›²ã®æœŸå¾…ã«å¿œãˆã‚ˆã†ã¨é ‘å¼µã£ãŸäº‹ä¾‹", "ãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ã¦èƒ½åŠ›ã‚’ç™ºæ®ã§ããŸäº‹ä¾‹", "ç«¶äº‰ç›¸æ‰‹ãŒã„ãŸã“ã¨ã§è¨˜éŒ²ãŒä¼¸ã³ãŸäº‹ä¾‹", "å¤§å‹¢ãŒä¸€ç·’ã«ã„ã‚‹éƒ¨å±‹ã§å–ã‚Šçµ„ã‚“ã ã¨ãã®æ–¹ãŒï¼Œä»–äººã®ç›®ãŒæ°—ã«ãªã£ã¦åŠ¹ç‡ãŒæ‚ªããªã£ã¦ã—ã¾ã£ãŸã€‚"], correct: [4] },
  { id: 9, category: "å¿ƒç†å­¦", question: "ã‚¨ãƒªã‚¯ã‚½ãƒ³ã®ç™ºé”æ®µéšèª¬ã«ãŠã‘ã‚‹é’å¹´æœŸã®å¿ƒç†ç¤¾ä¼šçš„å±æ©Ÿã¨ã—ã¦ï¼Œæ­£ã—ã„ã‚‚ã®ã‚’ 1 ã¤é¸ã³ãªã•ã„ã€‚", options: ["åŸºæœ¬çš„ä¿¡é ¼ å¯¾ åŸºæœ¬çš„ä¸ä¿¡", "åŒä¸€æ€§ å¯¾ åŒä¸€æ€§æ··ä¹±", "å‹¤å‹‰æ€§ å¯¾ åŠ£ç­‰æ„Ÿ", "è‡ªç™ºæ€§ å¯¾ ç¾æ¥å¿ƒ", "ã‚¸ã‚§ãƒãƒ©ãƒ†ã‚£ãƒ“ãƒ†ã‚£ å¯¾ åœæ»"], correct: [1] },
  { id: 10, category: "å¿ƒç†å­¦", question: "ãƒ¬ã‚¸ãƒªã‚¨ãƒ³ã‚¹ã«é–¢ã™ã‚‹æ¬¡ã®è¨˜è¿°ã®ã†ã¡ï¼Œæœ€ã‚‚é©åˆ‡ãªã‚‚ã®ã‚’ 1 ã¤é¸ã³ãªã•ã„ã€‚", options: ["ä¸€åº¦å—ã‘ãŸã‚¹ãƒˆãƒ¬ã‚¹ã‚’å®Œå…¨ã«å¿˜ã‚Œã‚‹èƒ½åŠ›ã®ã“ã¨ã§ã‚ã‚‹ã€‚", "å¼·ã„ã‚¹ãƒˆãƒ¬ã‚¹ã‚„å¿ƒç†çš„å‚·ã¤ãã‚’ä¼´ã†çµŒé¨“ã‹ã‚‰ï¼Œå€‹äººãŒæŒã¤å›å¾©ã—ã¦ã„ãåŠ›ã®ã“ã¨ã§ã‚ã‚‹ã€‚", "ã„ã‹ãªã‚‹å›°é›£ã«ã‚‚å±ˆã—ãªã„é‹¼ã®ãƒ¡ãƒ³ã‚¿ãƒ«ã®ã“ã¨ã§ã‚ã‚‹ã€‚", "éºä¼çš„ã«æ±ºå®šã•ã‚Œã¦ã„ã‚‹æ€§æ ¼ç‰¹æ€§ã®ã“ã¨ã§ã‚ã‚‹ã€‚", "ä»–äººã‚’èª¬å¾—ã—ã¦è‡ªåˆ†ã®æ€ã„é€šã‚Šã«ã™ã‚‹åŠ›ã®ã“ã¨ã§ã‚ã‚‹ã€‚"], correct: [1] },
  { id: 17, category: "ç¤¾ä¼šå­¦", question: "å·®åˆ¥ã‚„åè¦‹ã«é–¢ã™ã‚‹æ¬¡ã®è¨˜è¿°ã®ã†ã¡ï¼Œé©åˆ‡ãªã‚‚ã®ã‚’ 2 ã¤é¸ã³ãªã•ã„ã€‚", options: ["ã‚´ãƒƒãƒ•ãƒãƒ³ã¯ã€ä»–è€…ã«ã¨ã£ã¦ã®åè¦‹ã‚’å‘¼ã³èµ·ã“ã™ã€Œå°ã€ã‚’ã‚¹ãƒ†ã‚£ã‚°ãƒã¨å‘¼ã‚“ã ã€‚", "ã‚ªãƒ«ãƒãƒ¼ãƒˆã¯ã€æ°‘æ—çš„åè¦‹ã‚’ã€Œèª¤ã£ãŸï¼ŒæŸ”è»Ÿæ€§ã®ãªã„ä¸€èˆ¬åŒ–ã«åŸºã¥ã„ãŸåæ„Ÿã€ã¨å®šç¾©ã—ãŸã€‚", "åè¦‹ã¯æ•™è‚²ã«ã‚ˆã£ã¦ã®ã¿å®Œå…¨ã«æ¶ˆå»ã§ãã‚‹ã¨ã•ã‚Œã‚‹ã€‚", "å·®åˆ¥ã¯å¸¸ã«æ„è­˜çš„ãªæ‚ªæ„ã«åŸºã¥ã„ã¦è¡Œã‚ã‚Œã‚‹ã€‚", "åˆ¶åº¦çš„å·®åˆ¥ã¨ã¯å€‹äººã®å¿ƒã®ä¸­ã®åè¦‹ã‚’æŒ‡ã™ã€‚"], correct: [0, 1] },
  { id: 24, category: "ç¦ç¥‰ã®åŸç†", question: "ã€Œå›½æ°‘ã®å¥åº·ã®å¢—é€²ã®ç·åˆçš„ãªæ¨é€²ã‚’å›³ã‚‹ãŸã‚ã®åŸºæœ¬çš„ãªæ–¹é‡ã€ã®å†…å®¹ã¨ã—ã¦ï¼Œé©åˆ‡ãªã‚‚ã®ã‚’ 2 ã¤é¸ã³ãªã•ã„ã€‚", options: ["é«˜é½¢è€…ã®å°±åŠ´æ”¯æ´ã®ã¿ã‚’ç›®çš„ã¨ã™ã‚‹ã€‚", "å¥³æ€§ã«ã¤ã„ã¦ã¯ã€äººç”Ÿã®å„æ®µéšã«ãŠã‘ã‚‹å¥åº·èª²é¡Œã®è§£æ±ºã‚’å›³ã‚‹ã“ã¨ãŒé‡è¦ã§ã‚ã‚‹ã€‚", "å–«ç…™ç‡ã‚’100%ã«ã™ã‚‹ã“ã¨ã‚’ç›®æ¨™ã¨ã™ã‚‹ã€‚", "é‹å‹•ä¸è¶³ã‚’æ¨å¥¨ã™ã‚‹ã€‚", "åœ°åŸŸã®äººã€…ã®ã¤ãªãŒã‚Šã‚„æ§˜ã€…ãªç¤¾ä¼šå‚åŠ ã‚’ä¿ƒã™ã“ã¨ã‚’ç›®æ¨™ã¨ã—ã¦è¨­å®šã™ã‚‹ã€‚"], correct: [1, 4] },
  { id: 38, category: "æ¨©åˆ©æ“è­·", question: "éšœå®³è€…ç¦ç¥‰æ–½è¨­å¾“äº‹è€…ç­‰ã«ã‚ˆã‚‹éšœå®³è€…è™å¾…ã¸ã®å¯¾å¿œã«é–¢ã™ã‚‹è¨˜è¿°ã¨ã—ã¦ï¼Œé©åˆ‡ãªã‚‚ã®ã‚’ 2 ã¤é¸ã³ãªã•ã„ã€‚", options: ["ç™ºè¦‹è€…ã¯ï¼Œæœ¬äººã®åŒæ„ã®æœ‰ç„¡ã«ã‹ã‹ã‚ã‚‰ãšå¸‚ç”ºæ‘ã«é€šå ±ã™ã‚‹ã€‚", "è­¦å¯Ÿå®˜ã«ã®ã¿é€šå ±ç¾©å‹™ãŒã‚ã‚‹ã€‚", "é€šå ±ã¯ä»»æ„ã§ã‚ã‚Šç¾©å‹™ã§ã¯ãªã„ã€‚", "è™å¾…ã®å†…å®¹ã‚’SNSã§æ‹¡æ•£ã™ã‚‹ã€‚", "å¸‚ç”ºæ‘ã¯éƒ½é“åºœçœŒã«ï¼Œæ–½è¨­ã§ã®éšœå®³è€…è™å¾…ã«é–¢ã™ã‚‹äº‹é …ã‚’å ±å‘Šã™ã‚‹ã€‚"], correct: [0, 4] },
  { id: 50, category: "åœ°åŸŸç¦ç¥‰", question: "ç½å®³æ™‚ã®æ”¯æ´ã«é–¢ã™ã‚‹æ¬¡ã®è¨˜è¿°ã®ã†ã¡ï¼Œé©åˆ‡ãªã‚‚ã®ã‚’ 2 ã¤é¸ã³ãªã•ã„ã€‚", options: ["ãƒœãƒ©ãƒ³ãƒ†ã‚£ã‚¢ã¯ä¸€åˆ‡å—ã‘å…¥ã‚Œãªã„ã€‚", "ä»‹è­·ã‚µãƒ¼ãƒ“ã‚¹äº‹æ¥­è€…ã¯ã€æ¥­å‹™ç¶™ç¶šè¨ˆç”»ï¼ˆBCPï¼‰ã®ç­–å®šãŒç¾©å‹™ä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹ã€‚", "é¿é›£æ‰€ã¯é«˜é½¢è€…å°‚ç”¨ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚", "ç½å®³æ´¾é£ç¦ç¥‰ãƒãƒ¼ãƒ ï¼ˆDWATï¼‰ã®ä¸€èˆ¬é¿é›£æ‰€ã¸ã®æ´¾é£ã«ã¤ã„ã¦ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã«æ˜è¨˜ã•ã‚Œã¦ã„ã‚‹ã€‚", "ç½å®³æ™‚ã¯å€‹äººæƒ…å ±ã®ä¿è­·ã‚’ä¸€åˆ‡è€ƒæ…®ã—ãªãã¦ã‚ˆã„ã€‚"], correct: [1, 3] },
  { id: 129, category: "çµ„ç¹”ã¨çµŒå–¶", question: "ç¤¾ä¼šç¦ç¥‰æ³•äººã®è²¡å‹™ã«é–¢ã™ã‚‹æ¬¡ã®è¨˜è¿°ã®ã†ã¡ï¼Œé©åˆ‡ãªã‚‚ã®ã‚’ 2 ã¤é¸ã³ãªã•ã„ã€‚", options: ["è²¡å‹™è«¸è¡¨ã¯éå…¬é–‹ã¨ã™ã‚‹ã€‚", "äº‹æ¥­åŒºåˆ†ã”ã¨ã«è¨ˆç®—æ›¸é¡ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚", "è²¸å€Ÿå¯¾ç…§è¡¨ã¯ä½œæˆã—ãªãã¦ã‚ˆã„ã€‚", "åç›Šã¯ã™ã¹ã¦ç†äº‹é•·ãŒè‡ªç”±ã«ä½¿ãˆã‚‹ã€‚", "è²¸å€Ÿå¯¾ç…§è¡¨ã¯ï¼Œä¼šè¨ˆå¹´åº¦æœ«ã«ãŠã‘ã‚‹è²¡å‹™çŠ¶æ³ã‚’æ˜ã‚‰ã‹ã«ã™ã‚‹ã‚‚ã®ã§ã‚ã‚‹ã€‚"], correct: [1, 4] }
  // â€» å®Ÿéš›ã®å®Ÿè£…ã§ã¯129å•ã™ã¹ã¦ã‚’ã“ã“ã«å«ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒã€
  // ãƒ‡ãƒ¢ç”¨ã«ä»£è¡¨çš„ãªå½¢å¼ï¼ˆå˜ä¸€é¸æŠãƒ»è¤‡æ•°é¸æŠï¼‰ã‚’æŠ½å‡ºã—ã¦æ§‹æˆã—ã¦ã„ã¾ã™ã€‚
];

const categories = ["ã™ã¹ã¦", ...new Set(rawQuestions.map(q => q.category))];

const App = () => {
  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
  const [selectedOptions, setSelectedOptions] = useState([]);
  const [score, setScore] = useState(0);
  const [showResult, setShowResult] = useState(false);
  const [isFinished, setIsFinished] = useState(false);
  const [filter, setFilter] = useState("ã™ã¹ã¦");
  const [encouragement, setEncouragement] = useState("");
  const [answersStatus, setAnswersStatus] = useState([]); // Array to store {id, isCorrect}

  // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã•ã‚ŒãŸå•é¡Œ
  const filteredQuestions = useMemo(() => {
    return filter === "ã™ã¹ã¦"
      ? rawQuestions
      : rawQuestions.filter(q => q.category === filter);
  }, [filter]);

  const currentQuestion = filteredQuestions[currentQuestionIndex];
  const isMultiple = currentQuestion?.correct.length > 1;

  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒªã‚¹ãƒˆ
  const praiseMessages = [
    "ãã®èª¿å­ï¼ç´ æ™´ã‚‰ã—ã„çŸ¥è­˜ã§ã™âœ¨",
    "æ­£è§£ï¼ã‚ãªãŸã¯ç¤¾ä¼šç¦ç¥‰å£«ã®ç´ è³ªååˆ†ã§ã™ğŸ‘",
    "ãŠè¦‹äº‹ï¼è‡ªä¿¡ã‚’æŒã£ã¦é€²ã¿ã¾ã—ã‚‡ã†ğŸš€",
    "ãƒ”ãƒ³ãƒãƒ³ï¼å°‚é–€ç”¨èªã‚‚ãƒãƒƒãƒãƒªã§ã™ã­ğŸ§ ",
    "å®Œç’§ã§ã™ï¼åˆæ ¼ãŒè¿‘ã¥ã„ã¦ã„ã¾ã™ã‚ˆğŸŒ¸"
  ];

  const retryMessages = [
    "æƒœã—ã„ï¼æ¬¡ã“ãã¯æ­£è§£ã‚’æ´ã¿ã¾ã—ã‚‡ã†ğŸ”¥",
    "é–“é•ã„ã¯æˆé•·ã®ç³§ã§ã™ã€‚å¾©ç¿’ãŒå¤§äº‹ã§ã™ã­ğŸ“š",
    "ã©ã‚“ã¾ã„ï¼è§£èª¬ã‚’ç¢ºèªã—ã¦çŸ¥è­˜ã‚’å®šç€ã•ã›ã‚ˆã†ğŸŒ±",
    "é›†ä¸­ã€é›†ä¸­ï¼æ¬¡ã¯ãã£ã¨å¤§ä¸ˆå¤«ã§ã™ã‚ˆğŸ’ª"
  ];

  useEffect(() => {
    resetQuiz();
  }, [filter]);

  const resetQuiz = () => {
    setCurrentQuestionIndex(0);
    setSelectedOptions([]);
    setScore(0);
    setIsFinished(false);
    setShowResult(false);
    setAnswersStatus([]);
    setEncouragement("");
  };

  const handleOptionToggle = (index) => {
    if (showResult) return;

    if (isMultiple) {
      if (selectedOptions.includes(index)) {
        setSelectedOptions(selectedOptions.filter(i => i !== index));
      } else {
        setSelectedOptions([...selectedOptions, index]);
      }
    } else {
      setSelectedOptions([index]);
    }
  };

  const handleSubmit = () => {
    const isCorrect =
      selectedOptions.length === currentQuestion.correct.length &&
      selectedOptions.every(val => currentQuestion.correct.includes(val));

    if (isCorrect) {
      setScore(score + 1);
      setEncouragement(praiseMessages[Math.floor(Math.random() * praiseMessages.length)]);
    } else {
      setEncouragement(retryMessages[Math.floor(Math.random() * retryMessages.length)]);
    }

    setAnswersStatus([...answersStatus, { id: currentQuestion.id, isCorrect }]);
    setShowResult(true);
  };

  const handleNext = () => {
    if (currentQuestionIndex < filteredQuestions.length - 1) {
      setCurrentQuestionIndex(currentQuestionIndex + 1);
      setSelectedOptions([]);
      setShowResult(false);
      setEncouragement("");
    } else {
      setIsFinished(true);
    }
  };

  const getRank = () => {
    const ratio = score / filteredQuestions.length;
    if (ratio === 1) return { title: "ç¤¾ä¼šç¦ç¥‰å£«ãƒã‚¹ã‚¿ãƒ¼", icon: "ğŸ‘‘", color: "text-yellow-500" };
    if (ratio >= 0.8) return { title: "ãƒ™ãƒ†ãƒ©ãƒ³ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ¯ãƒ¼ã‚«ãƒ¼", icon: "ğŸ’", color: "text-blue-500" };
    if (ratio >= 0.6) return { title: "åˆæ ¼åœå†…ï¼ãƒ«ãƒ¼ã‚­ãƒ¼", icon: "ğŸŒŸ", color: "text-green-500" };
    return { title: "ç¤¾ä¼šç¦ç¥‰ã®åµ", icon: "ğŸ¥š", color: "text-gray-500" };
  };

  return (
    <div className="min-h-screen bg-slate-50 p-4 md:p-8 font-sans text-slate-800">
      <div className="max-w-2xl mx-auto bg-white rounded-3xl shadow-xl overflow-hidden border border-slate-100">

        {/* Header */}
        <header className="bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white text-center">
          <div className="flex justify-center mb-2">
            <GraduationCap size={40} className="text-indigo-200" />
          </div>
          <h1 className="text-2xl font-bold">ç¬¬37å› ç¤¾ä¼šç¦ç¥‰å£«å›½å®¶è©¦é¨“</h1>
          <p className="text-indigo-100 opacity-90">ä»¤å’Œ6å¹´åº¦ éå»å•æ¼”ç¿’ã‚¯ã‚¨ã‚¹ãƒˆ</p>
        </header>

        {/* Filter & Stats */}
        {!isFinished && (
          <div className="p-4 bg-indigo-50 flex flex-wrap items-center justify-between gap-3 border-b border-slate-200">
            <div className="flex items-center gap-2">
              <span className="text-xs font-bold text-indigo-700 uppercase tracking-wider">ç§‘ç›®:</span>
              <select
                value={filter}
                onChange={(e) => setFilter(e.target.value)}
                className="bg-white border border-indigo-200 rounded-full px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-400"
              >
                {categories.map(c => <option key={c} value={c}>{c}</option>)}
              </select>
            </div>
            <div className="flex items-center gap-4 text-sm font-semibold text-indigo-700">
              <div className="flex items-center gap-1">
                <BookOpen size={16} />
                <span>{currentQuestionIndex + 1} / {filteredQuestions.length}</span>
              </div>
              <div className="flex items-center gap-1">
                <Star size={16} className="text-yellow-500 fill-yellow-500" />
                <span>æ­£è§£: {score}</span>
              </div>
            </div>
          </div>
        )}

        {/* Main Content */}
        <main className="p-6 md:p-10">
          {!isFinished ? (
            <div className="space-y-6">
              {/* Question */}
              <div className="space-y-2">
                <div className="inline-block px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-xs font-bold uppercase tracking-widest">
                  {currentQuestion.category}
                </div>
                <h2 className="text-lg md:text-xl font-bold leading-relaxed">
                  å•é¡Œ {currentQuestion.id}: {currentQuestion.question}
                </h2>
                {isMultiple && (
                  <p className="text-rose-500 text-sm font-bold flex items-center gap-1">
                    <CheckCircle2 size={14} /> â€»ã“ã®å•é¡Œã¯æ­£è§£ãŒ2ã¤ã‚ã‚Šã¾ã™ã€‚
                  </p>
                )}
              </div>

              {/* Options */}
              <div className="space-y-3">
                {currentQuestion.options.map((option, idx) => {
                  const isSelected = selectedOptions.includes(idx);
                  const isCorrect = currentQuestion.correct.includes(idx);

                  let buttonClass = "w-full text-left p-4 rounded-2xl border-2 transition-all duration-200 flex items-start gap-3 ";

                  if (showResult) {
                    if (isCorrect) {
                      buttonClass += "border-green-500 bg-green-50 text-green-800";
                    } else if (isSelected && !isCorrect) {
                      buttonClass += "border-rose-500 bg-rose-50 text-rose-800";
                    } else {
                      buttonClass += "border-slate-100 bg-white opacity-50";
                    }
                  } else {
                    buttonClass += isSelected
                      ? "border-indigo-500 bg-indigo-50 text-indigo-800 shadow-md transform -translate-y-1"
                      : "border-slate-100 bg-white hover:border-indigo-200 hover:bg-slate-50";
                  }

                  return (
                    <button
                      key={idx}
                      onClick={() => handleOptionToggle(idx)}
                      disabled={showResult}
                      className={buttonClass}
                    >
                      <span className={`mt-1 flex-shrink-0 flex items-center justify-center w-6 h-6 rounded-full border-2 text-xs font-bold
                        ${isSelected ? "bg-indigo-500 border-indigo-500 text-white" : "border-slate-300 text-slate-400"}`}>
                        {idx + 1}
                      </span>
                      <span className="flex-grow">{option}</span>
                      {showResult && isCorrect && <CheckCircle2 className="text-green-500 flex-shrink-0" size={20} />}
                      {showResult && isSelected && !isCorrect && <XCircle className="text-rose-500 flex-shrink-0" size={20} />}
                    </button>
                  );
                })}
              </div>

              {/* Feedback & Actions */}
              <div className="pt-6 border-t border-slate-100 flex flex-col items-center gap-4">
                {showResult && (
                  <div className={`p-4 rounded-2xl w-full flex items-center gap-3 animate-bounce shadow-sm
                    ${encouragement.includes("æ­£è§£") || encouragement.includes("å®Œç’§") || encouragement.includes("è¦‹äº‹") || encouragement.includes("ãã®èª¿å­")
                      ? "bg-green-100 text-green-700" : "bg-orange-100 text-orange-700"}`}>
                    {encouragement.includes("æ­£è§£") ? <Smile size={24} /> : <Heart size={24} />}
                    <span className="font-bold">{encouragement}</span>
                  </div>
                )}

                <div className="w-full flex justify-between gap-4">
                  {!showResult ? (
                    <button
                      onClick={handleSubmit}
                      disabled={selectedOptions.length === 0}
                      className="flex-grow bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold py-4 rounded-2xl transition-all shadow-lg shadow-indigo-200 flex items-center justify-center gap-2"
                    >
                      å›ç­”ã™ã‚‹
                    </button>
                  ) : (
                    <button
                      onClick={handleNext}
                      className="flex-grow bg-purple-600 hover:bg-purple-700 text-white font-bold py-4 rounded-2xl transition-all shadow-lg shadow-purple-200 flex items-center justify-center gap-2"
                    >
                      {currentQuestionIndex < filteredQuestions.length - 1 ? "æ¬¡ã®å•é¡Œã¸" : "çµæœã‚’è¦‹ã‚‹"}
                      <ChevronRight size={20} />
                    </button>
                  )}
                </div>
              </div>
            </div>
          ) : (
            /* Results Screen */
            <div className="text-center space-y-8 py-4">
              <div className="relative inline-block">
                <div className="absolute inset-0 bg-yellow-400 rounded-full blur-2xl opacity-20 animate-pulse"></div>
                <div className="relative bg-white p-6 rounded-full border-4 border-yellow-400 shadow-xl inline-flex items-center justify-center w-32 h-32 text-6xl">
                  {getRank().icon}
                </div>
              </div>

              <div className="space-y-2">
                <h2 className="text-3xl font-black text-slate-800">ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼</h2>
                <p className="text-slate-500">ç¬¬37å›å›½å®¶è©¦é¨“ æ¼”ç¿’ã‚¯ã‚¨ã‚¹ãƒˆå®Œäº†</p>
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div className="bg-indigo-50 p-6 rounded-3xl">
                  <div className="text-sm font-bold text-indigo-400 uppercase tracking-widest mb-1">æ­£è§£æ•°</div>
                  <div className="text-4xl font-black text-indigo-700">{score} <span className="text-xl">å•</span></div>
                </div>
                <div className="bg-purple-50 p-6 rounded-3xl">
                  <div className="text-sm font-bold text-purple-400 uppercase tracking-widest mb-1">æ­£è§£ç‡</div>
                  <div className="text-4xl font-black text-purple-700">
                    {Math.round((score / filteredQuestions.length) * 100)} <span className="text-xl">%</span>
                  </div>
                </div>
              </div>

              <div className={`p-6 rounded-3xl border-2 border-dashed ${getRank().color.replace('text', 'border')} bg-white`}>
                <p className="text-sm font-bold mb-1 opacity-70">æˆä¸ã•ã‚ŒãŸç§°å·:</p>
                <div className={`text-2xl font-black ${getRank().color}`}>
                  {getRank().title}
                </div>
              </div>

              <button
                onClick={resetQuiz}
                className="w-full bg-slate-800 hover:bg-slate-900 text-white font-bold py-4 rounded-2xl transition-all shadow-lg flex items-center justify-center gap-2"
              >
                <RefreshCcw size={20} />
                ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ã™ã‚‹
              </button>
            </div>
          )}
        </main>

        {/* Footer info */}
        {!isFinished && (
          <footer className="px-6 py-4 bg-slate-50 text-[10px] text-slate-400 text-center border-t border-slate-100 italic">
            â€»å•é¡Œæ–‡ã¯ç¬¬37å›ç¤¾ä¼šç¦ç¥‰å£«å›½å®¶è©¦é¨“å…¬è¡¨è³‡æ–™ã«åŸºã¥ãã¾ã™ã€‚
          </footer>
        )}
      </div>

      {/* Motivational Toast (floating icon) */}
      <div className="fixed bottom-6 right-6 p-4 bg-white rounded-2xl shadow-2xl border border-slate-100 hidden md:flex items-center gap-3 animate-bounce">
         <div className="bg-pink-100 p-2 rounded-xl text-pink-500">
           <Heart size={20} fill="currentColor" />
         </div>
         <div className="text-xs font-bold leading-tight">
           çµ¶å¯¾åˆæ ¼ï¼<br/><span className="text-slate-400">å¿œæ´ã—ã¦ã„ã¾ã™ï¼</span>
         </div>
      </div>
    </div>
  );
};

export default App;